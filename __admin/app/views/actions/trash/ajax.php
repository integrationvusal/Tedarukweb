<?php/** * Created by PhpStorm. * User: Profit-NB * Date: 09.01.14 * Time: 18:39 */if ($_SERVER['HTTP_X_REQUESTED_WITH'] != 'XMLHttpRequest') {    die();}header('Content-type: text/html; charset=utf-8');define("_VALID_PHP", true);require_once('../classes/Database.php');$database = new Database;$pdo = $database->Connect();//if (isset($_POST['action']) && isset($_POST['id'])) {//    $actions = array('getChildren');//    $id = intval($_POST['id']);////    if (in_array($_POST['action'], $actions)) {//        if ($_POST['action'] == 'getChildren') {//            $children = array();//            $query = $pdo->query("SELECT * FROM `categories` WHERE `parent_id` = ".$id);//            while ($rql = $query->fetch(PDO::FETCH_ASSOC)) {//                $children[] = $rql;//            }//            echo json_encode($children);//        }//    } else {//        die();//    }//}$actions = array('getDistricts','order');if (isset($_POST['action'])) {    if (in_array($_POST['action'], $actions)) {        if ($_POST['action'] == 'getDistricts' && isset($_POST['id'])) {            $id = intval($_POST['id']);            $districts = array();            $query = $pdo->query("SELECT * FROM `districts` WHERE `region_id` = ".$pdo->quote($id));            while ($row = $query->fetch(PDO::FETCH_ASSOC)) {                $districts[] = $row;            }            echo json_encode($districts);        }        if($_POST['action'] == 'order') {            if(isset($_POST['data'])) {                //echo $_POST['data'];                $exp = explode("###",substr(trim($_POST['data']),0,strlen($_POST['data'])-3));                foreach($exp as $e) {                    $id = explode('=',$e);                    $order = $id[1];                    $id = explode('_',$id[0]);                    $id = $id[1];                    $pdo->query("UPDATE `categories` SET `position` = '".intval($order)."' WHERE `id` = '".intval($id)."' LIMIT 1");                }            }        }    } else {        die();    }}?>