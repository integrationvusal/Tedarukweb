<?phpif (!defined("_VALID_PHP"))    die('Direct access to this location is not allowed.');$order = @$_GET['order'];$sort = @$_GET['sort'];$st = @$_GET['st'];if (is_array($order)) {    $order = array_shift($order);}if (is_array($sort)) {    $sort = array_shift($sort);}if (is_array($st)) {    $st = array_shift($st);}$order = htmlspecialchars($order);$sort = htmlspecialchars($sort);$st = htmlspecialchars($st);if (isset($_GET['delete']) && is_numeric($_GET['delete'])) {    $sql_str = "";    if ($_GET['is_parent'] == 'yes') {        $sql_str = " OR `parent_id` = " . $pdo->quote(intval($_GET['delete']));    }    $sql = $pdo->query("DELETE FROM `categories` WHERE `id` = " . $pdo->quote(intval($_GET['delete'])) . $sql_str . "");    echo "<script language='javascript' type='text/javascript'>window.location = 'index.php?page=c_sections'</script>";}?><div class="content-box"><div class="content-box-header">    <h3>Меню</h3>    <div class="clear"></div></div><div class="content-box-content"><?phpif ($st == '' || $st == 0) {    $st = 1;}$name_ord_sel = ($order == 'ASC') ? 'DESC' : 'ASC';$name_sort_sel = ($sort == 'name') ? 'category' : 'position';$query = $pdo->query("SELECT * FROM `categories` ORDER BY `" . $name_sort_sel . "` " . $name_ord_sel);$setir = count($query->fetchAll(PDO::FETCH_ASSOC));//Testing Begin$par = array();$sql = $pdo->query('SELECT * FROM `categories` ORDER BY `position` ASC');while ($rql = $sql->fetch(PDO::FETCH_ASSOC)) {    $par[] = $rql;}$levels = array();$tree = array();$cur = array();foreach ($par as $rows) {    $cur = &$levels[$rows['id']];    $cur['parent_id'] = $rows['parent_id'];    $cur['category'] = $rows['category'];    $cur['id'] = $rows['id'];    if ($rows['parent_id'] == 0) {        $tree[$rows['id']] = &$cur;    } else {        $levels[$rows['parent_id']]['children'][$rows['id']] = &$cur;    }}function getTree($arr){    $out = '';    $out .= '<ul class="sortable" style="padding-left: 20px; margin-bottom: 5px;">';    foreach ($arr as $k => $v) {        $out .= '<li id="id_'.$v['id'].'">'.($v['parent_id'] == 0 ? '<b>'.$v['category'].'</b>' : $v['category']);        $out .= '<a href="index.php?page=c_edit_section&id='.$v['id'].'"><img src="<?=IMAGE_DIR;?>edit.png" class="list-ico" title="Редакотровать"/></a><a onclick="return confirm(\'Вы уверены что хотите удалить ?\')" href="index.php?page=c_sections&delete='.$v['id'].'&is_parent='.(!empty($v['children']) ? "yes" : "no").'" title="Удалить"><img src="<?=IMAGE_DIR;?>icons/cross.png" alt="Delete"/></a><span class="loader" style="visibility: hidden;"><img src=\'templates/default/images/2.gif\'></span>';        if (!empty($v['children'])) {            $out .= getTree($v['children']);        }        $out .= '</li>';    }    $out .= '</ul>';    return $out;}//Testing   Endif ($setir > 0) {    ?>    <form name="menu_list" action="" method="POST">        <?php echo getTree($tree);?><!--        <table width="100%" cellpadding="0" cellspacing="0" id="myTable" class="tablesorter sortable">--><!----><!--            <thead>--><!----><!--            <tr>--><!----><!--                <th id="menu_list_id">ID</th>--><!----><!--                <th id="menu_list_name">Название</th>--><!----><!--                <th id="menu_list_parent">Родитель</th>--><!----><!--                <th id="menu_list_added">Добавлено</th>--><!----><!--                <th>Управление</th>--><!----><!--            </tr>--><!----><!--            </thead>--><!----><!--            <tbody>--><!----><!--            --><?php//            $link_sc = "index.php?page=c_sections";//            $count = 70;//            $cnt = 100;//            $rpp = $count;//            $rad = 1;////            if (isset($st)) {//                $page = $st - 1;//            } else {//                $page = 0;//            }////            $links = $rad * 2 + 1;//            $pages = ceil($setir / $rpp);//            $start = $page - $rad;////            if ($start > $pages - $links) {//                $start = $pages - $links;//            }//            if ($start < 0) {//                $start = 0;//            }//            $end = $start + $links;//            if ($end > $pages) {//                $end = $pages;//            }////            for ($j = $start; $j < $end; $j++) {////                if ($j == $page) {////                    $sql = $pdo->query("SELECT * FROM `categories` ORDER BY `" . $name_sort_sel . "` " . $name_ord_sel . " LIMIT " . ($count * $j) . " ," . ($count) . "");////                    $row = $sql->fetchAll(PDO::FETCH_ASSOC);//////                    foreach ($row as $row1) {////                        $rParent = array();////                        if ($row1['parent_id'] != 0) {////                            $sqlP = $pdo->query("SELECT `category` FROM `categories` WHERE `id` = " . $pdo->quote($row1['parent_id']) . " LIMIT 1");////                            $rParent = $sqlP->fetchAll(PDO::FETCH_ASSOC);////                        }////                        ?><!----><!--                        <tr id="--><?php //echo 'id_' . $row1['id']; ?><!--">--><!----><!--                            <td width="3%">--><?php //echo $row1['id']; ?><!--</td>--><!----><!--                            <td width="40%">--><?php //echo $row1['category']; ?><!--</td>--><!----><!--                            <td width="40%">--><?php //echo isset($rParent[0]['category']) ? $rParent[0]['category'] : ''; ?><!--</td>--><!----><!--                            <td width="10%">--><?php //echo date("d.m.Y - H:i", strtotime($row1['created'])); ?><!--</td>--><!----><!--                            <td width="7%">--><!----><!--                                <a href="index.php?page=c_edit_section&id=--><?php //echo $row1['id']; ?><!--&rsp=--><?php //echo htmlspecialchars($st); ?><!--"><img--><!----><!--                                        src="<?=IMAGE_DIR;?>edit.png" class="list-ico" title="Редакотровать"/></a>--><!----><!--                                <a onclick="return confirm('Вы уверены что хотите удалить ?')"--><!----><!--                                   href="index.php?page=c_sections&st=--><?php //echo htmlspecialchars($st); ?><!--&order=--><?php //echo htmlspecialchars($order); ?><!--&sort=--><?php //echo htmlspecialchars($sort); ?><!--&delete=--><?php //echo $row1['id']; ?><!--&is_parent=--><?php //echo !isset($rParent[0][DEFAULT_LANG_DIR]) ? 'yes' : 'no'; ?><!--"--><!----><!--                                   title="Удалить"><img src="<?=IMAGE_DIR;?>icons/cross.png"--><!----><!--                                                        alt="Delete"/></a>--><!----><!--                                        <span class="loader" style="visibility: hidden;"><img--><!----><!--                                                src='templates/default/images/2.gif'></span>--><!----><!--                            </td>--><!----><!--                        </tr>--><!----><!--                    --><?php////                    } // menu list foreach end////                }////            }?><!----><!--            </tbody>--><!----><!--        </table>-->    </form><!--    <div class="pagination">--><!----><!--        --><?php////        if ($page > 0) {////            echo "<a href=\"$link_sc&st=1\">« First</a><a href=\"$link_sc&st=" . ($page) . "\">« Previous</a>";////        }////        for ($i = $start; $i < $end; $i++) {////            if ($i == $page) {////                echo '<a href="#" class="number current">';////            } else {////                echo "<a class='number' href=\"$link_sc&st=" . ($i + 1) . "\">";////            }////            echo($i + 1);//////            if ($i == $page) {////                echo "</b>";////            } else {////                echo "</a>";////            }////            if ($i != ($end - 1)) {////                echo "";////            }////        }////        if ($pages > $links && $page < ($pages - $rad - 1)) {////            echo " ... <a href=\"$link_sc&st=" . ($pages) . "\">" . ($pages) . "</a>";////        }////        if ($page < $pages - 1) {////            echo " <a  href=\"$link_sc&st=" . ($page + 2) . "\">Next »</a><a href=\"$link_sc&st=" . ($pages) . "\">Last »</a>";////        }////        ?><!----><!--    </div>--><?php} else {    echo '<div class="no_table_info">Информация отсутствует</div>';}?><div class="clear"></div><script type="text/javascript">    $(document).ready(function () {        /*var row_id = $('#menu_list_id');          // set cookoe value equal to 0         var row_name = $('#menu_list_name');        // set cookoe value equal to 1         var row_parent = $('#menu_list_parent'); // set cookoe value equal to 2         var row_added = $('#menu_list_added');       // set cookoe value equal to 3         row_id.click(function () {         $.cookie('cookie_menu_sort_row', '0', { expires: 7 });         });         row_name.click(function () {         $.cookie('cookie_menu_sort_row', '1', { expires: 7 });         });         row_parent.click(function () {         $.cookie('cookie_menu_sort_row', '2', { expires: 7 });         });         row_added.click(function () {         $.cookie('cookie_menu_sort_row', '3', { expires: 7 });         });         $("#myTable").tablesorter({         widgets: ["zebra", "filter"],         sortList: [         [$.cookie('cookie_menu_sort_row'), 0]         ],         headers: {         4: {sorter: false }         }         });*/ // sorter end    }); // ready end</script></div></div>